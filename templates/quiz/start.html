{% extends "base.html" %}
{% load env_tags %}
{% block title %}{{ quiz.title }}{% endblock %}

{% block content %}
<div class="container">
    <div id="lobby-container">
        <div class="card shadow" style="background: rgba(255, 255, 255, 0.95); border-radius: 15px;">
            <div class="card-header text-center" style="background: linear-gradient(45deg, #28a745, #20c997); border-radius: 15px 15px 0 0;">
                <h2 class="mb-0 text-white">{{ quiz.title }}</h2>
            </div>
            <div class="card-body text-center">
                <p class="fs-5">PIN for players: <strong class="fs-4">{{ session.code }}</strong></p>
                <button id="start-quiz-btn" class="btn btn-lg mb-4" style="background: linear-gradient(45deg, #007bff, #0056b3); color: white; border-radius: 10px;">Start Quiz!</button>
                
                <div class="mt-4">
                    <h4>Players Joined (<span id="player-count">0</span>):</h4>
                    <ul id="players-list" class="list-group mt-2" style="border-radius: 10px;"></ul>
                </div>
            </div>
        </div>
    </div>

    <div id="question-container" style="display: none;">
        <div class="card shadow mt-4" style="background: rgba(255, 255, 255, 0.95); border-radius: 15px;">
            <div class="card-header text-center" style="background: linear-gradient(45deg, #17a2b8, #6f42c1); border-radius: 15px 15px 0 0;">
                <h2 id="question-text" class="mb-0 text-white"></h2>
            </div>
            <div class="card-body">
                <div id="host-answers-container">
                    <div id="host-answer-a" class="p-3 mb-2 rounded fs-5 text-white" style="background: linear-gradient(45deg, #dc3545, #e83e8c);">A</div>
                    <div id="host-answer-b" class="p-3 mb-2 rounded fs-5 text-white" style="background: linear-gradient(45deg, #007bff, #0056b3);">B</div>
                    <div id="host-answer-c" class="p-3 mb-2 rounded fs-5 text-white" style="background: linear-gradient(45deg, #ffc107, #fd7e14);">C</div>
                    <div id="host-answer-d" class="p-3 mb-2 rounded fs-5 text-white" style="background: linear-gradient(45deg, #28a745, #20c997);">D</div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Твой JavaScript код остается без изменений
    const roomCode = "{{ session.code }}";
    const host = "{% get_env_var 'SERVER_HOST_PC' %}";
    const socket = new WebSocket(`ws://${host}/ws/quiz/${roomCode}/`);

    const lobbyContainer = document.getElementById('lobby-container');
    const questionContainer = document.getElementById('question-container');
    const playersList = document.getElementById('players-list');
    const playerCount = document.getElementById('player-count');
    const questionText = document.getElementById('question-text');
    const startButton = document.getElementById('start-quiz-btn');

    const hostAnswerA = document.getElementById('host-answer-a');
    const hostAnswerB = document.getElementById('host-answer-b');
    const hostAnswerC = document.getElementById('host-answer-c');
    const hostAnswerD = document.getElementById('host-answer-d');

    socket.onmessage = function(e) {
        const data = JSON.parse(e.data);
        console.log("Host received:", data);

        if (data.type === 'players_update') {
            playersList.innerHTML = ''; 
            data.players.forEach(name => {
                const li = document.createElement('li');
                li.className = 'list-group-item';
                li.textContent = name;
                playersList.appendChild(li);
            });
            playerCount.textContent = data.players.length;
        }
        else if (data.type === 'new_question') {
            lobbyContainer.style.display = 'none';
            
            questionText.textContent = data.question;
            hostAnswerA.textContent = `A: ${data.answers.A}`;
            hostAnswerB.textContent = `B: ${data.answers.B}`;
            hostAnswerC.textContent = `C: ${data.answers.C}`;
            hostAnswerD.textContent = `D: ${data.answers.D}`;
            questionContainer.style.display = 'block';
            document.getElementById('host-answers-container').style.display = 'block';
        }
        else if (data.type === 'round_results') {
            questionText.textContent = 'Get ready for the next question...';
            document.getElementById('host-answers-container').style.display = 'none';
        }
        else if (data.type === 'quiz_end') {
            questionText.textContent = 'Quiz Over! Thanks for playing.';
            document.getElementById('host-answers-container').style.display = 'none';
        }
    };

    startButton.addEventListener('click', () => {
        socket.send(JSON.stringify({'type': 'start_quiz'}));
        startButton.style.display = 'none';
    });
</script>
{% endblock %}